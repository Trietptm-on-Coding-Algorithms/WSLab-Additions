# Scripting Windows Update (Work in progress!)

## About the lab

Have a secondary "old" domain controller for exploiting.

## LabConfig

```PowerShell
$LabConfig=@{ DomainAdminName='LabAdmin'; AdminPassword='P@ssw0rd'; DomainName='cyberdefense-rangers.local'; DomainNetbiosName='RANGERS'; Prefix = 'ThreatHunting-'; SwitchName = 'LabSwitch'; DCEdition='4'; Internet=$true ; AdditionalNetworksConfig=@(); VMs=@()}

$LabConfig.VMs += @{ VMName = 'ForeignDC8R2' ; Configuration = 'Simple'; ParentVHD = 'Win2008R2SP1_G1.vhdx' ; MemoryStartupBytes= 1GB ; MGMTNICs=1; AddToolsVHD=$True; Unattend="NoDjoin" ; Generation = 1; AdditionalLocalAdmin='LabAdmin'}
 
```

## Scenario

Run the following command directly on ForeignDC8R2

```PowerShell
. D:\Scripts\Set-StaticIPAddressUsingWMI.ps1
. D:\Scripts\Install-TAFirst2008R2DomainController.ps1
Set-StaticIPAddressUsingWMI -IPAddress 172.16.0.1 -SubnetMask 255.255.255.0 -Gateway 10.0.0.1 -DNSServer 172.16.0.1
Install-TAFirst2008R2DomainController -Domain foreign.local -NetBiosDomainName foreign -ADSite 'Nebrasca' -Domainlevel 4 -ForestLevel 4 -DSSafeModePassword 'P@ssw0rd'

```